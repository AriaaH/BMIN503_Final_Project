---
title: "BMIN503/EPID600 Project"
author: "Zheyuan(Aria) Huang"
output: 
  html_document:
    theme: paper
    highlight: tango
---
```{r set-options, echo=FALSE, cache=FALSE}
options(width = 400)
```  
***
Use this template to complete your project throughout the course. Your Final Project presentation will be based on the contents of this document. Replace the title/name above and text below with your own, but keep the headers.

### Overview
Give a brief a description of your project and its goal(s), what data you are using to complete it, and what three faculty/staff in different fields you have spoken to about your project with a brief summary of what you learned from each person. Include a link to your final project GitHub repository.

The project aims to design protein circuits that can sense clusters of diseased proteins to cause targeted cell death. The data analyzed here are collected based on cell apoptosis after cells being transfected with different apoplectic constructs at various time points. The goal of this project is to determine the optimal protein circuit design to engineer cell death in cancerous cells. 


### Introduction 
Describe the problem addressed, its significance, and some background to motivate the problem.

Explain why your problem is interdisciplinary, what fields can contribute to its understanding, and incorporate background related to what you learned from meeting with faculty/staff.

The goal of the project is to engineer protein clusters that could lead to controlled apoptosis thus creating a therapeutic tool for cancer treatment. The problem of interest here seeks the expertise from protein engineering, cell signaling, cancer biology, and quantitative analysis. By combining knowledge from these fields, we will be able to deepen our knowledge on protein clustering as an emergent form of cancer therapy.  
From my conversations with the faculties, I realized that the dataset might seem simple from a mathematical perspective, but to interpret it correctly and drawing the correlation between different techniques with phenotype will be challenging. It will be crucial to put any finding into the context and evaluate the results by biological and technical principles. 

### Methods
Source data: Split TEV Cry2.csv
Variables: 
- Time: time point when the cells were imaged 
  t = 0/2/6/8/12 hrs 

- Plasmid: 
  split TEV-PC3
  TEV trunc
  TEV trunc TEVcsQ
  TEV trunc TEVcsL
  TEV trunc TEVcsM
  Cry2-GFP
  
- Fluorescent Channels: 
  mCherry
  mCherry+DAPI
  mCherry+FITC
  mCherry+FITC+DAPI
  
- Treatments: 
  base 
  stimulated (stimulated with FITC)
  
- Experiment setup: 
  Cells stimulated with FITC are hypothesized to express the transfected constructs which would lead to cell apoptosis. 
  mCherry - apoptosis circuit is activated 
  DAPI: cell nuclei
  FITC: cry2 - to stimulate the death circuit to start 
  
- Using the time point fluorescence data collected on cells transfected with different constructs, I plan to analyze 
  1. fluorescence progression throughout the time course   
  2. cell count for fluorescence expressing cells and dying cells at each time point 
  3. expression difference between stimulated and base cells

### Time point data 
```{r}
install.packages("reshape")
install.packages("ggthemes")
library(ggplot2)
library(reshape)
library(ggthemes)
# read in time point data
tpdata <- read.csv(
  file = "expression over time.csv",
  header = TRUE,
  sep = ",",
  dec = "."
)
head(tpdata)

# subset data to create groups 
mchdata <- tpdata[c(1:7)]
mchfdata <- tpdata[c(1,8:13)]
mchddata <- tpdata[c(1,14:19)]
mchfddata <- tpdata[c(1,20:25)]


# melt data so that multiple lines can be plotted together 
mchdata.m <-melt(mchdata,id.vars="time")
mchfdata.m <-melt(mchfdata,id.vars="time")
mchddata.m <-melt(mchddata,id.vars="time")
mchfddata.m <-melt(mchfddata,id.vars="time")


# plot time point data
ggplot(mchdata.m, aes(x=time, y=value, colour=variable)) +
    geom_line() + 
    theme_bw()+scale_colour_tableau()+
    labs(x="Time", y="Cell Count", title='mCherry expression over time')

ggplot(mchfdata.m, aes(x=time, y=value, colour=variable)) +
    geom_line() + 
    theme_bw()+scale_colour_tableau()+
  labs(x="Time", y="Cell Count", title='mCherry+FITC expression over time')  

ggplot(mchddata.m, aes(x=time, y=value, colour=variable)) +
    geom_line() + 
    theme_bw()+scale_colour_tableau()+
  labs(x="Time", y="Cell Count", title='mCherry death over time') 

ggplot(mchfddata.m, aes(x=time, y=value, colour=variable)) +
    geom_line() + 
    theme_bw()+scale_colour_tableau()+
  labs(x="Time", y="Cell Count", title='mCherry+FITC death over time') 
```
### Expression/death analysis at each time point 
```{r}
# load death expression data
library(dplyr)
library(tidyr)
library(ggplot2)
library(ggthemes)
dedata <- read.csv(
  file = "death expression.csv",
  header = TRUE,
  sep = ",",
  dec = "."
)
head(dedata)

# calculate the % dying/expressing cell by comparing the +DAPI groups with the no DAPI groups  
dedata$perc.mch<-dedata$Dapi.mCh/dedata$mCh
dedata$perc.fitc<-dedata$Dapi.Fitc/dedata$FITC
dedata$perc.both<-dedata$Dapi.Both/dedata$both

# assign stimulated/unstimulated status based on plate setup
dedata$status[dedata$cond>5] <- 1
dedata$status[dedata$cond<6] <- 0
dedata$status[dedata$cond>10] <- "control"
dedata$status[dedata$cond==12]<-"cry2"

# filter by status 
stim<-filter(dedata,status=="1")
base<-filter(dedata,status=="0")

# find difference between basal and stimulated (mcherry only and mcherry+fitc)
difstim<-data.frame(base$time,base$perc.mch,stim$perc.both)
difstim$delta<-difstim$stim.perc.both-difstim$base.perc.mch
names(difstim)[1:3] <- c('time',"perc.mch","perc.both")
difstim$construct<-rep(c("split","TEV trunc","TEV trunc TEVcsQ","TEV trunc TEVcsL","TEV trunc TEVcsM"),times=5)
# rename constructs 
difstim.m <-melt(difstim,id.vars="construct")

# plot average percent expression for all the constructs 
difstim.m<-melt(difstim, id = "construct", measure = c("perc.mch","perc.both"))
ggplot(difstim.m, aes(x=construct, y=value, colour=variable)) +
    geom_boxplot() + 
    theme_bw()+scale_colour_tableau()+
    labs(x="Constructs", y="Percentage expressed",title='Percentage expression average') 

# paired t-test on the difference between unstimulated and stimulated groups 
t.test(difstim$perc.both,difstim$perc.mch, paired = TRUE, alternative = "two.sided")


# plot the stimulation difference over time with respect to each construct 
interaction.plot(x.factor = difstim$time, trace.factor = difstim$construct, 
                 response = difstim$delta, fun = mean, 
                 xlab = "Time", ylab="Stimulation difference",
                 type = "b", legend = TRUE, 
                 labs(fill='Construct'),
                 pch=c(1,20), col = c("#00AFBB", "#E7B800"))

# two-way anova on the interction effects of constructs/time on stimulation difference 
aov2 <- aov( delta~ time + construct + time:construct, data = difstim)
summary(aov2)
# variance check
plot(aov2, 1)
# normality check
plot(aov2, 2)



```
### plot seperately
library("ggplot2")
ggplot(basaldata, aes(time, plasmid)) +
           geom_point(na.rm=TRUE)+
           ggtitle("basal death %") +
           xlab("groups") + ylab("basal expression death % ")
ggplot(sdata, aes(time, plasmid)) +
           geom_point(na.rm=TRUE)+
           ggtitle("stimulated death %") +
           xlab("groups") + ylab("stimulated expression death % ")
           

### dying and expression comparison at each time point 
### seperate data by time point 
data0<-filter(finaldata,time=0)
data2<-filter(finaldata,time=2)
data6<-filter(finaldata,time=6)
data8<-filter(finaldata,time=8)
data12<-filter(finaldata,time=12)

### t test on expression
### for t0
t.test(x = data0$mCherry+DAPI, y=data0$mCherry+FITC+DAPI,
       alternative = c("two.sided", "less", "greater"),
       mu = 0, paired = FALSE, var.equal = FALSE,
       conf.level = 0.95, â€¦)
### repeat for the rest time points 



### Results
Describe your results and include relevant tables, plots, and code/comments used to obtain them. End with a brief conclusion of your findings related to the question you set out to address. You can include references if you'd like, but this is not required.

 figure 1: basal death %
 y-axis: basal expression death % 
 x-axis: construct groups and pbs (control)

 figure 2: stimulated death %
 y-axis: stimulated expression death % 
 x-axis: construct groups and pbs (control)

### also inlcude normalized curve on each plot (normalize to t0)

### statistical results
---------------
